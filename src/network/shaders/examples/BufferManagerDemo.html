<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced BufferManager Demo - Phase 2.3</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .demo-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        
        .controls {
            text-align: center;
            margin-bottom: 25px;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 8px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        button:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .status {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
            font-weight: 600;
        }
        
        .status.success {
            background: #e8f5e8;
            border-left-color: #4CAF50;
            color: #2e7d32;
        }
        
        .status.error {
            background: #ffebee;
            border-left-color: #f44336;
            color: #c62828;
        }
        
        .status.warning {
            background: #fff3e0;
            border-left-color: #ff9800;
            color: #ef6c00;
        }
        
        .console {
            background: #1e1e1e;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            max-height: 600px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.4;
            border: 1px solid #333;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .feature-card h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .feature-card ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .feature-card li {
            margin: 5px 0;
            color: #666;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            margin: 5px 0;
        }
        
        .metric-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .progress-ring {
            width: 100px;
            height: 100px;
            margin: 20px auto;
            position: relative;
        }
        
        .progress-ring svg {
            transform: rotate(-90deg);
        }
        
        .progress-ring circle {
            fill: none;
            stroke-width: 8;
        }
        
        .progress-ring .bg {
            stroke: #e0e0e0;
        }
        
        .progress-ring .progress {
            stroke: #4CAF50;
            stroke-linecap: round;
            transition: stroke-dasharray 0.5s ease;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics {
                grid-template-columns: repeat(2, 1fr);
            }
            
            button {
                padding: 12px 20px;
                font-size: 14px;
                margin: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ Enhanced BufferManager Demo</h1>
        <p><strong>Phase 2.3: GPU Buffer Management</strong></p>
        <p>Advanced WebGPU buffer management for neural network operations</p>
        <p><em>Two-Wheel Balancing Robot RL Application</em></p>
    </div>

    <div class="demo-container">
        <h2>üéØ Demo Features</h2>
        <div class="feature-grid">
            <div class="feature-card">
                <h3>üîß Enhanced Buffer Operations</h3>
                <ul>
                    <li>Advanced buffer creation with validation</li>
                    <li>Async operations with error handling</li>
                    <li>Efficient data upload/download</li>
                    <li>Buffer size limits and validation</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>üîÑ Buffer Pooling System</h3>
                <ul>
                    <li>Automatic buffer reuse for performance</li>
                    <li>Configurable pool sizes and aging</li>
                    <li>Hit rate optimization</li>
                    <li>Memory usage reduction</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>üß† Neural Network Integration</h3>
                <ul>
                    <li>Enhanced WebGPU neural network</li>
                    <li>Optimized buffer management</li>
                    <li>Batch operation support</li>
                    <li>Real-time performance monitoring</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>üìä Performance Monitoring</h3>
                <ul>
                    <li>Real-time memory usage tracking</li>
                    <li>Buffer operation timing</li>
                    <li>Pool efficiency metrics</li>
                    <li>Error tracking and reporting</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="demo-container">
        <h2>üéÆ Demo Controls</h2>
        <div class="controls">
            <button id="runDemo" onclick="runFullDemo()">Run Complete Demo</button>
            <button id="runBasic" onclick="runBasicDemo()">Basic Operations Only</button>
            <button id="runNetwork" onclick="runNetworkDemo()">Neural Network Demo</button>
            <button id="clearConsole" onclick="clearConsole()">Clear Console</button>
        </div>
        
        <div id="status" class="status">
            Ready to run enhanced BufferManager demonstrations.
            <br>Click "Run Complete Demo" to test all features.
        </div>
    </div>

    <div class="demo-container">
        <h2>üìä Performance Metrics</h2>
        <div id="metrics" class="metrics">
            <div class="metric-card">
                <div class="metric-value" id="memoryUsage">--</div>
                <div class="metric-label">Memory Usage</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="bufferCount">--</div>
                <div class="metric-label">Buffer Count</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="poolHitRate">--</div>
                <div class="metric-label">Pool Hit Rate</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="avgCreationTime">--</div>
                <div class="metric-label">Avg Creation Time</div>
            </div>
        </div>
        
        <div class="progress-ring" id="progressRing" style="display: none;">
            <svg width="100" height="100">
                <circle class="bg" cx="50" cy="50" r="40"></circle>
                <circle class="progress" cx="50" cy="50" r="40" 
                        stroke-dasharray="0 251.2" id="progressCircle"></circle>
            </svg>
        </div>
    </div>

    <div class="demo-container">
        <h2>üñ•Ô∏è Console Output</h2>
        <div id="console" class="console">
Enhanced BufferManager Demo Console
====================================

WebGPU Status: Checking compatibility...
Ready for demo execution.

This demo will demonstrate:
1. Basic buffer operations with enhanced features
2. Neural network integration with optimized buffer management
3. Buffer pooling efficiency and performance gains
4. Batch operations for training scenarios
5. Memory management and validation
6. Real-time performance monitoring

Click "Run Complete Demo" to begin comprehensive testing.
        </div>
    </div>

    <script type="module">
        import { runBufferManagerDemo } from './BufferManagerDemo.js';
        
        let isRunning = false;
        let currentDemo = null;
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            checkWebGPUSupport();
        });
        
        async function checkWebGPUSupport() {
            const status = document.getElementById('status');
            const consoleDiv = document.getElementById('console');
            
            if (!navigator.gpu) {
                status.textContent = '‚ùå WebGPU not supported in this browser. Please use Chrome 113+ or Edge 113+.';
                status.className = 'status error';
                appendToConsole('‚ùå WebGPU not supported - demo cannot run');
                return;
            }
            
            try {
                const adapter = await navigator.gpu.requestAdapter();
                if (!adapter) {
                    throw new Error('No suitable adapter found');
                }
                
                status.textContent = '‚úÖ WebGPU supported and ready for enhanced buffer management demo.';
                status.className = 'status success';
                appendToConsole('‚úÖ WebGPU compatibility confirmed');
                appendToConsole('üöÄ Enhanced BufferManager ready for demonstration');
                
            } catch (error) {
                status.textContent = `‚ö†Ô∏è WebGPU adapter issue: ${error.message}`;
                status.className = 'status warning';
                appendToConsole(`‚ö†Ô∏è WebGPU adapter issue: ${error.message}`);
            }
        }
        
        window.runFullDemo = async function() {
            if (isRunning) return;
            
            updateRunningState(true);
            appendToConsole('\\nüöÄ Starting Complete Enhanced BufferManager Demo...\\n');
            
            try {
                const results = await runBufferManagerDemo();
                displayResults(results);
                
                document.getElementById('status').textContent = 'üéâ Complete demo finished successfully!';
                document.getElementById('status').className = 'status success';
                
            } catch (error) {
                appendToConsole(`‚ùå Demo failed: ${error.message}`);
                console.error('Demo error:', error);
                
                document.getElementById('status').textContent = `‚ùå Demo failed: ${error.message}`;
                document.getElementById('status').className = 'status error';
            } finally {
                updateRunningState(false);
            }
        };
        
        window.runBasicDemo = async function() {
            if (isRunning) return;
            
            updateRunningState(true);
            appendToConsole('\\nüìã Running Basic Buffer Operations Demo...\\n');
            
            try {
                // Import and run just basic operations
                const { BufferManagerDemo } = await import('./BufferManagerDemo.js');
                const demo = new BufferManagerDemo();
                
                await demo.initializeDevice();
                await demo.demoBasicOperations();
                await demo.cleanup();
                
                document.getElementById('status').textContent = '‚úÖ Basic operations demo completed successfully!';
                document.getElementById('status').className = 'status success';
                
            } catch (error) {
                appendToConsole(`‚ùå Basic demo failed: ${error.message}`);
                console.error('Basic demo error:', error);
                
                document.getElementById('status').textContent = `‚ùå Basic demo failed: ${error.message}`;
                document.getElementById('status').className = 'status error';
            } finally {
                updateRunningState(false);
            }
        };
        
        window.runNetworkDemo = async function() {
            if (isRunning) return;
            
            updateRunningState(true);
            appendToConsole('\\nüß† Running Neural Network Integration Demo...\\n');
            
            try {
                // Import and run neural network demo
                const { BufferManagerDemo } = await import('./BufferManagerDemo.js');
                const demo = new BufferManagerDemo();
                
                await demo.initializeDevice();
                await demo.demoNeuralNetworkIntegration();
                await demo.cleanup();
                
                document.getElementById('status').textContent = '‚úÖ Neural network demo completed successfully!';
                document.getElementById('status').className = 'status success';
                
            } catch (error) {
                appendToConsole(`‚ùå Network demo failed: ${error.message}`);
                console.error('Network demo error:', error);
                
                document.getElementById('status').textContent = `‚ùå Network demo failed: ${error.message}`;
                document.getElementById('status').className = 'status error';
            } finally {
                updateRunningState(false);
            }
        };
        
        window.clearConsole = function() {
            document.getElementById('console').textContent = 'Console cleared. Ready for new demo output.\\n';
            
            // Reset metrics
            document.getElementById('memoryUsage').textContent = '--';
            document.getElementById('bufferCount').textContent = '--';
            document.getElementById('poolHitRate').textContent = '--';
            document.getElementById('avgCreationTime').textContent = '--';
        };
        
        function updateRunningState(running) {
            isRunning = running;
            const buttons = document.querySelectorAll('button');
            buttons.forEach(btn => btn.disabled = running);
            
            const progressRing = document.getElementById('progressRing');
            if (running) {
                progressRing.style.display = 'block';
                animateProgress();
            } else {
                progressRing.style.display = 'none';
            }
        }
        
        function animateProgress() {
            const circle = document.getElementById('progressCircle');
            const circumference = 2 * Math.PI * 40;
            let progress = 0;
            
            const interval = setInterval(() => {
                if (!isRunning) {
                    clearInterval(interval);
                    return;
                }
                
                progress += Math.random() * 5;
                if (progress > 95) progress = 95;
                
                const offset = circumference - (progress / 100) * circumference;
                circle.style.strokeDasharray = `${circumference - offset} ${offset}`;
                
            }, 300);
        }
        
        function appendToConsole(text) {
            const consoleDiv = document.getElementById('console');
            consoleDiv.textContent += text + '\\n';
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        function displayResults(results) {
            appendToConsole('\\nüìä DEMO RESULTS SUMMARY');
            appendToConsole('=' .repeat(50));
            
            if (results.performanceMonitoring) {
                const perf = results.performanceMonitoring;
                
                document.getElementById('avgCreationTime').textContent = perf.avgCreationTime.toFixed(2) + 'ms';
                document.getElementById('poolHitRate').textContent = perf.poolHitRate;
                
                appendToConsole(`\\nüìà Performance Metrics:`);
                appendToConsole(`  Avg Creation Time: ${perf.avgCreationTime.toFixed(2)}ms`);
                appendToConsole(`  Pool Hit Rate: ${perf.poolHitRate}`);
                appendToConsole(`  Error Count: ${perf.errorCount}`);
            }
            
            if (results.memoryManagement) {
                const mem = results.memoryManagement;
                document.getElementById('bufferCount').textContent = mem.buffersCreated;
                document.getElementById('memoryUsage').textContent = mem.finalUtilization + '%';
                
                appendToConsole(`\\nüíæ Memory Management:`);
                appendToConsole(`  Buffers Created: ${mem.buffersCreated}`);
                appendToConsole(`  Memory Utilization: ${mem.finalUtilization}%`);
            }
            
            appendToConsole('\\nüéâ Enhanced BufferManager Demo Completed Successfully!');
            appendToConsole('    Production-ready GPU buffer management validated.');
        }
        
        // Intercept console.log to display in our console
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, arguments);
            appendToConsole(args.join(' '));
        };
    </script>
</body>
</html>