<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BufferManager Tests - Phase 2.3</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .test-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .controls {
            text-align: center;
            margin-bottom: 20px;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        .benchmark-btn {
            background: #2196F3;
        }
        
        .benchmark-btn:hover {
            background: #1976D2;
        }
        
        .clear-btn {
            background: #f44336;
        }
        
        .clear-btn:hover {
            background: #d32f2f;
        }
        
        .results {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            background-color: #f9f9f9;
            white-space: pre-wrap;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            max-height: 500px;
            overflow-y: auto;
            line-height: 1.4;
        }
        
        .test-passed {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .test-failed {
            color: #f44336;
            font-weight: bold;
        }
        
        .test-running {
            color: #2196F3;
            font-weight: bold;
        }
        
        .summary {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .summary.success {
            background: #e8f5e8;
            border-left-color: #4CAF50;
        }
        
        .summary.failure {
            background: #ffebee;
            border-left-color: #f44336;
        }
        
        .benchmark-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }
        
        .metric {
            display: inline-block;
            background: #f0f0f0;
            padding: 8px 12px;
            margin: 4px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .progress {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .feature-list {
            columns: 2;
            column-gap: 20px;
            margin: 15px 0;
        }
        
        .feature-list li {
            margin: 5px 0;
            break-inside: avoid;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .feature-list {
                columns: 1;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ BufferManager Test Suite</h1>
        <p>Phase 2.3: Enhanced GPU Buffer Management</p>
        <p>Two-Wheel Balancing Robot RL Application</p>
    </div>

    <div class="test-container">
        <h2>üìã Test Features</h2>
        <p>This comprehensive test suite validates the enhanced BufferManager implementation:</p>
        
        <ul class="feature-list">
            <li>‚úÖ Buffer creation with pooling</li>
            <li>‚úÖ Async operations with error handling</li>
            <li>‚úÖ Memory tracking and validation</li>
            <li>‚úÖ Buffer size limits and bounds checking</li>
            <li>‚úÖ Batch operations for efficiency</li>
            <li>‚úÖ Performance monitoring and metrics</li>
            <li>‚úÖ Neural network buffer creation</li>
            <li>‚úÖ Utility function validation</li>
            <li>‚úÖ Concurrent operation safety</li>
            <li>‚úÖ Large data handling with staging</li>
            <li>‚úÖ Buffer reuse patterns</li>
            <li>‚úÖ Cleanup and resource management</li>
        </ul>
    </div>

    <div class="test-container">
        <h2>üéÆ Test Controls</h2>
        <div class="controls">
            <button id="runTests" onclick="runAllTests()">Run All Tests</button>
            <button id="runBenchmark" onclick="runBenchmark()" class="benchmark-btn">Run Performance Benchmark</button>
            <button id="runQuick" onclick="runQuickTest()">Quick Test</button>
            <button id="clearResults" onclick="clearResults()" class="clear-btn">Clear Results</button>
        </div>
        
        <div class="progress" id="progressContainer" style="display: none;">
            <div class="progress-bar" id="progressBar"></div>
        </div>
    </div>

    <div class="test-container">
        <h2>üìä Test Results</h2>
        <div id="results" class="results">
Ready to run tests. Click "Run All Tests" to begin comprehensive validation.

Expected outcomes:
- All buffer operations should complete successfully
- Memory tracking should be accurate
- Pool efficiency should show performance improvements
- Error handling should catch and report issues appropriately
- Batch operations should demonstrate efficiency gains
        </div>
    </div>

    <script type="module">
        import { runBufferManagerTests, BufferManagerTests, BufferManagerBenchmark } from './BufferManagerTests.js';
        
        let isRunning = false;
        
        window.runAllTests = async function() {
            if (isRunning) return;
            isRunning = true;
            
            updateUI(true);
            appendResults('üöÄ Starting comprehensive BufferManager test suite...\n\n');
            
            try {
                const results = await runBufferManagerTests();
                displayTestResults(results);
            } catch (error) {
                appendResults(`‚ùå Test suite failed: ${error.message}\n`);
                console.error('Test suite error:', error);
            } finally {
                isRunning = false;
                updateUI(false);
            }
        };
        
        window.runBenchmark = async function() {
            if (isRunning) return;
            isRunning = true;
            
            updateUI(true);
            appendResults('‚ö° Starting performance benchmark...\n\n');
            
            try {
                const benchmark = new BufferManagerBenchmark();
                const results = await benchmark.runBenchmark();
                displayBenchmarkResults(results);
            } catch (error) {
                appendResults(`‚ùå Benchmark failed: ${error.message}\n`);
                console.error('Benchmark error:', error);
            } finally {
                isRunning = false;
                updateUI(false);
            }
        };
        
        window.runQuickTest = async function() {
            if (isRunning) return;
            isRunning = true;
            
            updateUI(true);
            appendResults('‚ö° Running quick validation test...\n\n');
            
            try {
                const testSuite = new BufferManagerTests();
                await testSuite.setup();
                
                // Run a subset of critical tests
                const quickTests = [
                    'testBasicBufferCreation',
                    'testAsyncOperations',
                    'testMemoryTracking',
                    'testValidation'
                ];
                
                let passed = 0;
                let failed = 0;
                
                for (const testName of quickTests) {
                    try {
                        await testSuite[testName]();
                        appendResults(`‚úÖ ${testName}\n`);
                        passed++;
                    } catch (error) {
                        appendResults(`‚ùå ${testName}: ${error.message}\n`);
                        failed++;
                    }
                }
                
                await testSuite.cleanup();
                
                appendResults(`\nüìä Quick Test Summary: ${passed} passed, ${failed} failed\n`);
                
                if (failed === 0) {
                    appendResults('üéâ All quick tests passed! Core functionality is working.\n');
                } else {
                    appendResults('‚ö†Ô∏è  Some quick tests failed. Run full test suite for details.\n');
                }
                
            } catch (error) {
                appendResults(`‚ùå Quick test failed: ${error.message}\n`);
                console.error('Quick test error:', error);
            } finally {
                isRunning = false;
                updateUI(false);
            }
        };
        
        window.clearResults = function() {
            document.getElementById('results').textContent = 'Results cleared. Ready for new tests.';
        };
        
        function updateUI(running) {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(btn => btn.disabled = running);
            
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            
            if (running) {
                progressContainer.style.display = 'block';
                // Simulate progress
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.random() * 10;
                    if (progress > 100) progress = 100;
                    progressBar.style.width = progress + '%';
                    
                    if (!isRunning) {
                        clearInterval(interval);
                        progressBar.style.width = '100%';
                        setTimeout(() => {
                            progressContainer.style.display = 'none';
                            progressBar.style.width = '0%';
                        }, 500);
                    }
                }, 200);
            }
        }
        
        function appendResults(text) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.textContent += text;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        function displayTestResults(results) {
            const { tests, benchmark } = results;
            
            appendResults('üìã TEST RESULTS\n');
            appendResults('='.repeat(50) + '\n\n');
            
            // Display test summary
            const passed = tests.passed;
            const failed = tests.failed;
            const total = passed + failed;
            
            if (failed === 0) {
                appendResults(`üéâ All ${total} tests PASSED!\n\n`);
            } else {
                appendResults(`üìä Test Summary: ${passed}/${total} passed, ${failed} failed\n\n`);
            }
            
            // Display individual test results
            appendResults('Individual Test Results:\n');
            for (const result of tests.results) {
                const status = result.status === 'PASSED' ? '‚úÖ' : '‚ùå';
                appendResults(`${status} ${result.test}\n`);
                if (result.error) {
                    appendResults(`   Error: ${result.error}\n`);
                }
            }
            
            appendResults('\n');
            
            // Display benchmark summary if available
            if (benchmark) {
                displayBenchmarkResults(benchmark);
            }
            
            // Performance recommendations
            appendResults('\nüí° RECOMMENDATIONS\n');
            appendResults('='.repeat(30) + '\n');
            if (failed === 0) {
                appendResults('‚úÖ BufferManager is production-ready\n');
                appendResults('‚úÖ All safety validations are working\n');
                appendResults('‚úÖ Memory management is functioning correctly\n');
                appendResults('‚úÖ Performance optimizations are active\n');
            } else {
                appendResults('‚ö†Ô∏è  Issues detected - review failed tests\n');
                appendResults('üîß Consider debugging specific components\n');
            }
        }
        
        function displayBenchmarkResults(results) {
            appendResults('\n‚ö° PERFORMANCE BENCHMARK\n');
            appendResults('='.repeat(40) + '\n\n');
            
            // Buffer creation performance
            if (results.bufferCreation) {
                appendResults('Buffer Creation Performance:\n');
                for (const [size, metrics] of Object.entries(results.bufferCreation)) {
                    appendResults(`  ${size}: ${metrics.avgTime} avg (${metrics.iterations} iterations)\n`);
                }
                appendResults('\n');
            }
            
            // Memory operations performance
            if (results.memoryOperations) {
                appendResults('Memory Operations Performance:\n');
                for (const [size, metrics] of Object.entries(results.memoryOperations)) {
                    appendResults(`  ${size}: Write ${metrics.avgWriteTime}, Read ${metrics.avgReadTime}\n`);
                    appendResults(`         Throughput: ${metrics.throughputMBps} MB/s\n`);
                }
                appendResults('\n');
            }
            
            // Batch operations performance
            if (results.batchOperations) {
                appendResults('Batch Operations Performance:\n');
                for (const [batch, metrics] of Object.entries(results.batchOperations)) {
                    appendResults(`  ${batch}: ${metrics.avgTimePerOp} per op, ${metrics.opsPerSecond} ops/sec\n`);
                }
                appendResults('\n');
            }
            
            // Pool efficiency
            if (results.poolEfficiency) {
                appendResults('Buffer Pool Efficiency:\n');
                const pool = results.poolEfficiency;
                appendResults(`  Without Pool: ${pool.withoutPool.avgTime} avg\n`);
                appendResults(`  With Pool:    ${pool.withPool.avgTime} avg\n`);
                appendResults(`  Improvement:  ${pool.improvement.speedup} speedup\n`);
                appendResults(`  Hit Rate:     ${pool.withPool.hitRate}\n`);
                appendResults(`  Reused:       ${pool.withPool.totalReused} buffers\n`);
                appendResults('\n');
            }
        }
        
        // Auto-run quick test on page load for immediate feedback
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                appendResults('üîÑ Auto-running quick validation...\n\n');
                runQuickTest();
            }, 1000);
        });
    </script>
</body>
</html>